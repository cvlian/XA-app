#!/bin/sh
#------------------------------------------------------------------------------
#
# /home/autodist/build_20201103_192241/tibero6/client/bin/tbpcc
#
# tbESQL Commands file for Compiler
#
# Lines starting with a # character are comments which are ignored.
#
# Generated by gen_tbpcc.sh at Wed Nov  4 00:37:04 KST 2020
#
#------------------------------------------------------------------------------

usage () {
    echo "Usage: tbpcc [options] file..." >&2
    echo 
    echo "  --help          Print a description of the command line." >&2
    echo 
    echo "  -o <file>       Write output to outfile. If -o is not specified, the default" >&2   
    echo "                  is to put an executable file in the name of the first file." >&2
    echo 
    echo "  -I<directory>   Add the directory to the list of directories to be searched" >&2
    echo "                  for header files." >&2
    echo 
    echo "  -L<directory>   Add the directory to the list of directories to be searched" >&2
    echo "                  for library files." >&2
    echo 
    echo "  -l<file>        Search the library when linking." >&2
    echo 
    echo "  -D<name>        Predefine name as a macro, with definition 1." >&2
    echo 
}

defined_output=0
input_cnt=0
input=''
output=''
cflags=''
include="-I$TB_HOME/client/include"
libdir="-L$TB_HOME/client/lib"
library="-ltbertl -lpthread -lm -lclientcommon"

while test $# != 0; do
    case "$1" in
        -h|--help)
            usage
            exit
            ;;
        -o)
            shift
            defined_output=1
            output="-o $1"
            ;;
        -I)
            shift
            include="$include -I$1"
            ;;
        -I*)
            include="$include $1"
            ;;
        -L)
            shift
            libdir="$libdir -L$1"
            ;;
        -L*)
            libdir="$libdir $1"
            ;;
        -l*)
            library="$library $1"
            ;;
        -D)
            shift
            cflags="$cflags -D$1"
            ;;
        -D*)
            cflags="$cflags $1"
            ;;
        -*)
            echo "ERROR: Invalid option $1." >&2
            echo
            usage
            exit 1
            ;;
        *)
            input_cnt=`expr $input_cnt + 1`
            input="$input $1"
            ;;
    esac
    shift
done

if [ $input_cnt = 0 ]; then
    echo "ERROR: No Input File." >&2
    exit 1
else
    input=`echo $input | sed -e "s/\.c//g"`

    if [ $input_cnt = 1 ]; then
        input="$input.c"
    else
        tmp_input="$input"
        input=''

        for each_file in $tmp_input
        do
            input="$input $each_file.c"
        done
    fi
fi

if [ $defined_output = 0 ]; then
    output=`echo $input | sed -e "s/ .*//g" -e "s/\.c//g"`
    output="-o $output"
fi

gcc $output $input -g $include $cflags $libdir $library
